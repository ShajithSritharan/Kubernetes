(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3577],{91715:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/sign-in",function(){return n(58183)}])},52012:function(e,t,n){"use strict";n.d(t,{My:function(){return h},Qb:function(){return v},p9:function(){return g}});var r=n(98788),i=n(22970),a=n(5632),o=/*#__PURE__*/n.n(a),u=n(42541),s=n(90581),c=n(99669),l={defaultTTL:86400},f=new/*#__PURE__*/(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;(0,s.Z)(this,e),this._storage=t,this._options=n}var t=e.prototype;return t.setItem=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._options.defaultTTL,r=Math.floor(Date.now()/1e3);this._storage.setItem(e,{value:t,exp:r+n})},t.getItem=function(e){var t=this._storage.getItem(e);if(null==t||"object"!=typeof t)return t;if(!Reflect.has(t,"value")||!Reflect.has(t,"exp"))return console.warn('ExpiryLocalStorage.getItem("'.concat(e,'") - data is malformed'),t),null;var n=Math.floor(Date.now()/1e3);return n>t.exp?(console.debug('ExpiryLocalStorage.getItem("'.concat(e,'") - data has expired ').concat(n-t.exp," seconds ago")),this._storage.removeItem(e),null):t.value},t.removeItem=function(e){this._storage.removeItem(e)},t.clear=function(){this._storage.clear()},e}())(c.J),d="auth/redirect";function p(e){return!(!e.startsWith("/")||e.includes("/../")||e.includes("/./")||e.includes("//"))}function g(e){if(!p(e)){console.warn("Invalid redirect path attempted: ".concat(e));return}var t=e.replace(/[<>"']/g,"").replace(/javascript:/gi,"").replace(/data:/gi,"");f.setItem(d,t,900)}function h(){var e=f.getItem(d);return"string"!=typeof e?null:p(e)?e:(console.warn("Invalid redirect path found in storage: ".concat(e)),m(),null)}function m(){f.removeItem(d)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=(0,r.Z)(function(e,t){var n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:if(n=h(),console.debug("Redirect to ".concat(null!=n?n:e)),!(n&&p(n)))return[3,2];return m(),u.Z.trackEvent("login-page","redirect_to_saved_path",{source:t,url:n,workspaceId:n.split("/")[2]}),[4,o().replace(n)];case 1:return r.sent(),[3,4];case 2:return[4,o().replace(e)];case 3:r.sent(),r.label=4;case 4:return[2]}})})).apply(this,arguments)}},69857:function(e,t,n){"use strict";n.d(t,{i:function(){return w}});var r=n(98788),i=n(22970),a=n(5632),o=/*#__PURE__*/n.n(a),u=n(2784),s=n(69904),c=n(57685),l=n(45403),f=n(57821),d=["website","notion","integration","diagramgpt","chatgpt","sourcegraph-cody","git-diagrammer","product-hunt"],p=n(89960),g=n(88218),h=n(61490),m=n(57335),v=n(52012),_=function(e){o().replace(e)},y=function(){return _("/team/create")};function w(){var e,t=(0,c.K)(),n=(0,l.Pe)(),a=(0,u.useState)(),w=a[0],b=a[1],I=(0,u.useState)({}),A=I[0],N=I[1],T=(0,u.useRef)({redirect:"",isRedirecting:!1});(0,s.Z)(function(){var e=o().query.redirect;"string"==typeof e&&((0,v.p9)(e),T.current.redirect=e)}),(0,u.useEffect)(function(){var e,n,r,i,a;N((n=(e=t).ref,r=e.utm_campaign,i=e.templateId,a=e.page,r?{signUpOrigin:"paid",signUpCampaign:r}:i?{signUpOrigin:"website",signUpTemplate:i}:{signUpOrigin:"string"==typeof n&&d.includes(n)?n:"other",signUpPage:null!=a?a:""}))},[t]);var R=(0,u.useCallback)(function(){o().prefetch("/dashboard/all"),o().prefetch("/team/create"),o().prefetch("/team/join"),o().prefetch("/new")},[]),E=(0,u.useCallback)(function(){o().query.redirect_uri===m.NOTION_INTEGRATION_REDIRECT_URL&&o().replace("/notion/auth?"+new URLSearchParams(o().query).toString())},[]),k=(0,u.useCallback)(function(e){console.info("[Auth Page] Something went wrong",e),(0,p.Tb)(e),b(e)},[]),C=(0,u.useCallback)((e=(0,r.Z)(function(e){var t,r,a,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),console.info("[Auth Page] User signed in:",{uid:e.uid,email:e.email,isAnonymous:e.isAnonymous,displayName:e.displayName}),E(),R(),[4,(0,h.backOffRetry)(function(){return n.userTeams.doesUserHaveTeam(e.uid)})];case 1:if(t=i.sent(),r=[],!(!t&&e.email&&e.emailVerified&&!T.current.isRedirecting))return[3,3];return a=(0,g.ZP)(e.email),[4,(0,h.backOffRetry)(function(){return n.teams.list({domain:a,isAutoJoinEnabled:!0},{})})];case 2:r=i.sent(),i.label=3;case 3:if(T.current.isRedirecting)return[2];return t?(console.info("[Auth Page] User has team, redirect to ..."),s=(null===(u=o().asPath)||void 0===u?void 0:u.match("sign-up"))?"sign-up":"sign-in",(0,v.Qb)("/dashboard/all",s)):e.email?(console.info("[Auth Page] User has ".concat(r.length," teams with the same domain")),r.length>0?_("/team/join"):y()):(console.info("[Auth Page] User doesn't have email, redirect to team create"),y()),[3,5];case 4:return k(i.sent()),[3,5];case 5:return[2]}})}),function(t){return e.apply(this,arguments)}),[E,R,k]),U=(0,u.useCallback)(function(e){console.info("[Auth Page] User signed out:",{uid:null==e?void 0:e.uid,email:null==e?void 0:e.email,isAnonymous:null==e?void 0:e.isAnonymous,displayName:null==e?void 0:e.displayName}),(0,f.hf)()},[]);return(0,u.useEffect)(function(){return n.auth.onAuthStateChanged(function(e){e&&!e.isAnonymous&&e.providerData.length>0?C(e):U(e)})},[C,U]),{error:w,profileArgs:A}}},58183:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return s}});var r=n(52322),i=n(58410),a=n(69857),o=n(70759),u=n(69023),s=!0;t.default=function(){var e=(0,a.i)(),t=e.error,n=e.profileArgs;return t?/*#__PURE__*/(0,r.jsx)(i.Z,{statusCode:500,title:"Something went wrong"}):"undefined"==typeof document?null:/*#__PURE__*/(0,r.jsx)(u.Z,{staticLogo:!0,children:/*#__PURE__*/(0,r.jsx)(o.o,{profileArgs:n})})}},57335:function(e,t,n){"use strict";n.r(t),n.d(t,{NOTION_INTEGRATION_REDIRECT_URL:function(){return f},default:function(){return d}});var r=n(52322),i=n(2784),a=n(37164),o=n(5632),u=n(58410),s=n(96933),c=n(67640),l=n(89960),f="https://www.notion.so/externalintegrationauthcallback",d=function(){var e=(0,o.useRouter)(),t=(0,s.fC)(),n=e.query.code,f=e.query.redirect_uri,d=e.query.state;return((0,i.useEffect)(function(){if(t&&n){if(null==t?void 0:t.isAnonymous){e.replace("/auth/sign-up?ref=notion&"+new URLSearchParams(e.query).toString());return}var r,i=(0,a.x0)();(r={notionAuthCode:n,tempAuthCode:i,userEmail:t.email,userDisplayName:t.displayName},c.Z.post("notion/retrieveToken",r,{responseType:"text"})).then(function(e){if(null==e){location.replace(f+"?error=access_denied&error_description=Not+valid+access+token..");return}location.replace(f+"?code=".concat(i,"&state=").concat(d))}).catch(function(e){(0,l.Tb)(e),location.replace(f+"?error=access_denied&error_description=An+internal+server+error+occurred.")})}},[t,n,d,f,e]),f&&n&&d)?null:/*#__PURE__*/(0,r.jsx)(u.Z,{statusCode:400,title:"Not enough query parameters specified"})}}},function(e){e.O(0,[2888],function(){return e(e.s=91715)}),_N_E=e.O()}]);